<script src="node_modules\js-cookie\src\js.cookie.js"></script>
<script type="text/javascript">
	function myFunc() {
		//console.log("Du har trykket på submit")
		var xhr = new XMLHttpRequest();
		var url_login = "http://viaworks.dmf.int/RestService/4/api/Login/Forms/Session";
		var url_search = "http://viaworks.dmf.int/RestService/4/api/Search?q=*%20vw(vwr(Source%3DKjellerarkiv%201%5C%5Cbv-rapporter%20samlet%205.5.2017))&r=1&s=0&format=json&sort=score%20desc&lang=en-US&spid=0&df=&dt=&tags="
		var payload = {"IsPersistent":'true',"Credentials":[{"Name":"windowsusername","Value":"kimknuds"},{"Name":"windowspassword","Value":"Jalla9012"},{"Name":"windowsdomain","Value":"dmf"}]}
		

		xhr.open('POST', url_login, true);
		xhr.setRequestHeader('Content-type', 'application/json');
		xhr.withCredentials = true;
		xhr.onreadystatechange = function () {
		    // do something to response
		    if(this.status == 200) {
		    	//console.log("Printer inni xhr.onload function")
		    	
		    	if(this.responseText){
		    		//console.log(this.responseText);
		    		var json = JSON.parse(this.responseText)
		    		
		    		var auth_cookie = ".ASPXAUTH="+json["Data"]["AuthCookie"]+";"
			    	//console.log(auth_cookie)
			    	document.getElementById("user").innerHTML = json["Data"]["UserDisplayName"]
					document.cookie = auth_cookie;
					Cookies.set('.ASPXAUTH', json["Data"]["AuthCookie"], { path: '/' });
		    	

			      	xhr.open('GET', url_search, true);
			     	xhr.withCredentials = true;
					
					xhr.onreadystatechange = function () {
					    // do something to response
					    if(this.status == 200) {
					    	//console.log("Printer inni xhr.onload function")
					    	
					    	if(this.responseText){
					    		var json = JSON.parse(this.responseText)

				    			var documentId = json["Data"]["Hits"][0]["DocumentId"]
								var documentName = json["Data"]["Hits"][0]["Name"]
						    	document.getElementById("doc").innerHTML = JSON.stringify(json["Data"]["Hits"][0])
					    	}	
					    }
					};
					xhr.send();

		    	}

		    }
		};
		xhr.send(JSON.stringify(payload));


	}
</script>
<div id="header">
	<img src="grafikk/dmflogo.no.svg" width="50px" >
	<b>DIRMIN - Søk i arkiv</b>

</div>
<input type="text" placeholder="Verdi">
<input type="submit" onClick="myFunc()" value="Søk">
<!-- <input type="image" onClick="myFunc()"  src= "https://dirmin.no/sites/all/themes/dmf/css/images/sok.svg" width="20px" border="1"  style="border-color: #969696; margin-left: -5px; margin-top: 5px">  -->

<div id="user">
</div>

<div id="doc">
</div>